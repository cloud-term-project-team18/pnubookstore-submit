<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <title>판매 물품 등록</title>
</head>
<body>
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow-lg p-3 mb-5 bg-body rounded">
                <div class="card-body">
                    <h1 class="card-title text-center mb-4">판매 물품 등록</h1>
                    <form id="productForm" class="needs-validation" novalidate enctype="multipart/form-data" action="/product-register" method="post">
                        <div class="mb-3">
                            <label for="title" class="form-label">물품 이름:</label>
                            <input type="text" class="form-control" id="title" name="productName" required>
                            <div class="invalid-feedback">물품 이름을 입력해주세요.</div>
                        </div>
                        <div class="mb-3 row">
                            <div class="col-md-3">
                                <label for="college" class="form-label">대학:</label>
                                <select class="form-select" id="college" name="college" required>
                                    <option value="">대학</option>
                                </select>
                                <div class="invalid-feedback">대학을 선택해주세요.</div>
                            </div>
                            <div class="col-md-3">
                                <label for="department" class="form-label">학과:</label>
                                <select class="form-select" id="department" name="department" required>
                                    <option value="">학과</option>
                                </select>
                                <div class="invalid-feedback">학과를 선택해주세요.</div>
                            </div>
                            <div class="col-md-3">
                                <label for="professor" class="form-label">교수:</label>
                                <select class="form-select" id="professor" name="professor" required>
                                    <option value="">교수명</option>
                                </select>
                                <div class="invalid-feedback">교수명을 선택해주세요.</div>
                            </div>
                            <div class="col-md-3">
                                <label for="subject" class="form-label">과목:</label>
                                <select class="form-select" id="subject" name="subjectName" required>
                                    <option value="">과목</option>
                                </select>
                                <div class="invalid-feedback">과목을 선택해주세요.</div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="author" class="form-label">저자:</label>
                            <input type="text" class="form-control" id="author" name="author" required>
                            <div class="invalid-feedback">저자을 입력해주세요.</div>
                        </div>
                        <div class="mb-3">
                            <label for="price" class="form-label">가격:</label>
                            <input type="number" class="form-control" id="price" name="price" required>
                            <div class="invalid-feedback">가격을 입력해주세요.</div>
                        </div>
                        <div class="mb-3">
                            <label for="image" class="form-label">이미지 업로드:</label>
                            <input class="form-control" type="file" id="image" name="productPicture" accept="image/*" required>
                            <div class="invalid-feedback">이미지를 업로드해주세요.</div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">이름 기입:</label>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" id="nameYes" name="naming" value="yes" required>
                                <label class="form-check-label" for="nameYes">예</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" id="nameNo" name="naming" value="no" required>
                                <label class="form-check-label" for="nameNo">아니오</label>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">페이지 변색:</label>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" id="discolorYes" name="discolor" value="yes" required>
                                <label class="form-check-label" for="discolorYes">예</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" id="discolorNo" name="discolor" value="no" required>
                                <label class="form-check-label" for="discolorNo">아니오</label>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">페이지 훼손:</label>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" id="damageYes" name="damage" value="yes" required>
                                <label class="form-check-label" for="damageYes">예</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" id="damageNo" name="damage" value="no" required>
                                <label class="form-check-label" for="damageNo">아니오</label>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">밑줄 여부:</label>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" id="underlineNone" name="underline" value="NO" required>
                                <label class="form-check-label" for="underlineNone">없음</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" id="underlinePencil" name="underline" value="PENCIL" required>
                                <label class="form-check-label" for="underlinePencil">연필</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" id="underlinePen" name="underline" value="PEN" required>
                                <label class="form-check-label" for="underlinePen">볼펜</label>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">필기 여부:</label>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" id="writingNone" name="note" value="NO" required>
                                <label class="form-check-label" for="writingNone">없음</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" id="writingPencil" name="note" value="PENCIL" required>
                                <label class="form-check-label" for="writingPencil">연필</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" id="writingPen" name="note" value="PEN" required>
                                <label class="form-check-label" for="writingPen">볼펜</label>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="buildingName" class="form-label">건물 이름:</label>
                            <input type="text" class="form-control" id="buildingName" name="buildingName" required>
                            <div class="invalid-feedback">건물 이름을 입력해 주세요.</div>
                        </div>
                        <div class="mb-3">
                            <label for="lockerNumber" class="form-label">사물함 번호:</label>
                            <input type="number" class="form-control" id="lockerNumber" name="lockerNumber" required>
                            <div class="invalid-feedback">사물함 번호를 입력해주세요.</div>
                        </div>
                        <div class="mb-3">
                            <label for="password" class="form-label">자물쇠 비밀번호:</label>
                            <input type="number" class="form-control" id="password" name="password" required>
                            <div class="invalid-feedback">자물쇠 비밀번호를 입력해주세요.</div>
                        </div>
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg">물품 등록</button>
                        </div>
                        <div id="successMessage" class="alert alert-success mt-3 d-none" role="alert">
                            물품이 성공적으로 등록되었습니다.
                        </div>
                        <div id="errorMessage" class="alert alert-danger mt-3 d-none" role="alert">
                            물품 등록 중 오류가 발생했습니다. 다시 시도해주세요.
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Bootstrap JS and Popper.js -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    // JavaScript for form validation
    (function () {
        'use strict';

        var form = document.getElementById('productForm');

        form.addEventListener('submit', function (event) {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }

            form.classList.add('was-validated');
        }, false);
    })();

    // Load subjects dynamically based on college, department, and professor selection
    $(document).ready(function() {
        loadSelectBoxData('/api/colleges', '#college');

        $('#college').change(function() {
            const college = $(this).val();
            if (college) {
                loadSelectBoxData('/api/departments?college=' + college, '#department');
            } else {
                $('#department').empty().append('<option value="">학과</option>');
                $('#professor').empty().append('<option value="">교수명</option>');
                $('#subject').empty().append('<option value="">과목</option>');
            }
        });

        $('#department').change(function() {
            const college = $('#college').val();
            const department = $(this).val();
            if (college && department) {
                loadSelectBoxData('/api/professors?college=' + college + '&department=' + department, '#professor');
            } else {
                $('#professor').empty().append('<option value="">교수명</option>');
                $('#subject').empty().append('<option value="">과목</option>');
            }
        });

        $('#professor').change(function() {
            const college = $('#college').val();
            const department = $('#department').val();
            const professor = $(this).val();
            if (college && department && professor) {
                loadSelectBoxData('/api/subjects?college=' + college + '&department=' + department + '&professor=' + professor, '#subject');
            } else {
                $('#subject').empty().append('<option value="">과목</option>');
            }
        });

        function loadSelectBoxData(endpoint, selectBoxId) {
            $.ajax({
                url: endpoint,
                type: 'GET',
                dataType: 'json',
                success: function(data) {
                    const selectBox = $(selectBoxId);
                    selectBox.empty();
                    selectBox.append('<option value="">선택</option>');
                    data.forEach(item => {
                        selectBox.append('<option value="' + item + '">' + item + '</option>');
                    });
                },
                error: function() {
                    console.error('데이터를 로드하는 중 오류가 발생했습니다.');
                }
            });
        }
    });
</script>
</body>
</html>
